@page "/commands"
@using BlackDragonAI_Manager.BlbApi
@using BlackDragonAI_Manager.BlbApi.Models
@inject BlbApiHandler BlbApiHandler
@inject NavigationManager NavigationManager

<h1>Commands</h1>

<div>
    @if (_distinctCommands != null)
    {
        @foreach (var command in _distinctCommands)
        {
            <div class="card text-white" @onclick="() => GoToCommandEditPage(command.OriginalCommand)" style="cursor: pointer !important">
                <div class="card-body card-space">
                    <h5 class="card-title">@command.OriginalCommand</h5>
                    <p>@command.Message</p>
                </div>
            </div>
        }
    }
</div>

<img src="images/PlusIcon.png" @onclick="() => GoToCommandEditPage(_newCommandString)" style="position: fixed; z-index: 1; bottom: 0; right: 0; width: 215px; height: 215px; margin-right: 30px; margin-bottom: 30px; cursor: pointer">

@code {
    private readonly string _newCommandString = "new";
    private IEnumerable<CommandDetails> _commands;
    private IEnumerable<CommandDetails> _distinctCommands;

    protected override async Task OnInitializedAsync()
    {
        this._commands = await this.BlbApiHandler.GetAllCommands();
        this._distinctCommands = this._commands.Where(c => c.Command.Equals(c.OriginalCommand));
    }

    public void GoToCommandEditPage(string commandName)
    {
        this.NavigationManager.NavigateTo($"commands/{commandName}");
    }

}
